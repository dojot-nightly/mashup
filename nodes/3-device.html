<script type="text/x-red" data-template-name="device">
   <div class="form-row">
       <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
       <input type="text" id="node-input-name">
   </div>
   <div class="form-row">
       <label for="node-input-device"><i class="fa fa-wifi"></i> Device</label>
       <select id="node-input-device" style="">
       </select>
   </div>
</script>

<script type="text/x-red" data-help-name="device">
   <p>Select a configured device.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('device',{
        category: 'input',      // the palette category
        defaults: {              // defines the editable properties of the node
            name: {value:"", required:true},
            device: {value:"", required:true}
        },
        inputs:0,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        align: "left",          // align the icon
        icon: "bridge-dash.png", // set the icon (held in icons dir below where you save the node)
        color: "#f3b567",        // background-color
        label: function() {      // sets the default label contents
            return this.name||"device";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
           var select = document.getElementById("node-input-device");

           $.getJSON('http://localhost:5000/device', function (data) {
               $.each(data.devices, function(index,item) {
                 select.options[select.options.length] = new Option(item.label, item.id);
               });
           });
        }
    });
</script>
